cmake_minimum_required(VERSION 3.16)

set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)

# --- Fetch stb libraries ---
FetchContent_Declare(
    stb
    GIT_REPOSITORY https://github.com/nothings/stb.git
    GIT_TAG master
)
FetchContent_MakeAvailable(stb)

# --- Fetch the pebmeister STL project ---
FetchContent_Declare(
    pebmeister_stl
    GIT_REPOSITORY https://github.com/pebmeister/stl.git
    GIT_TAG master
)
FetchContent_MakeAvailable(pebmeister_stl)

# --- Fetch GLM (header-only) ---
FetchContent_Declare(
    glm
    GIT_REPOSITORY https://github.com/g-truc/glm.git
    GIT_TAG 0.9.9.8 # You can update to a newer tag if needed
)
FetchContent_MakeAvailable(glm)

# --- Create a library target from the STL source ---
add_library(stl_lib
    ${pebmeister_stl_SOURCE_DIR}/stl.cpp
    ${pebmeister_stl_SOURCE_DIR}/stl.h
)
target_include_directories(stl_lib PUBLIC
    ${pebmeister_stl_SOURCE_DIR}
)

# --- Now create your main executable ---
add_executable(magic_eye
    Camera.h
    DepthMapGenerator.h
    Options.h
    ParseArgs.h
    SIRDSGenerator.h
    StereogramGenerator.h
    TextureSampler.h
    vectorutils.h
    stl_to_sirds.cpp
)

# --- Add stb include directory ---
target_include_directories(magic_eye PRIVATE ${stb_SOURCE_DIR})

# --- Link the STL library and GLM into magic_eye ---
target_link_libraries(magic_eye PRIVATE stl_lib glm::glm)
